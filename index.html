<!DOCTYPE html>
<html lang="zh-CN">
<head>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="箱型报价">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>木箱报价计算器</title>
<style>
* {box-sizing:border-box;margin:0;padding:0}
body{font-family:Segoe UI,Microsoft YaHei,Helvetica,Arial;background:#f5f7fa;padding:15px;color:#333}
.container{max-width:1000px;margin:0 auto;background:#fff;border-radius:10px;box-shadow:0 6px 25px rgba(0,0,0,.08);overflow:hidden}
.header{background:linear-gradient(135deg,#3498db 0%,#2c3e50 100%);color:#fff;padding:25px;text-align:center}
.header h1{font-size:26px;margin-bottom:6px}
.section{padding:25px}
h3{margin-bottom:15px;font-size:18px}
.btn{padding:9px 18px;border:none;border-radius:6px;font-size:15px;cursor:pointer;transition:.25s}
.btn-primary{background:#3498db;color:#fff}
.btn-primary:hover{background:#2980b9}
.btn-success{background:#2ecc71;color:#fff}
.btn-success:hover{background:#27ae60}
.btn-danger{background:#e74c3c;color:#fff;font-size:13px;padding:6px 12px}
.btn-block{width:100%;margin-top:12px}
.box-item{background:#f8fafc;border:1px solid #e1e8ed;border-radius:8px;padding:12px 15px;margin-bottom:12px;display:flex;flex-wrap:wrap;align-items:center;gap:12px}
.box-item:hover{box-shadow:0 4px 12px rgba(0,0,0,.06)}
.box-item-header{width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.box-item-title{font-weight:600;color:#2c3e50}
.input-group{display:flex;flex-direction:column;min-width:110px;flex:1}
.input-group label{font-size:12px;color:#555;margin-bottom:4px}
.input-group input{padding:7px 9px;border:1px solid #ccd3db;border-radius:4px;font-size:14px}
.input-group input:focus{outline:none;border-color:#3498db}
.unit{font-size:11px;color:#95a5a6;margin-top:3px}
.result-area{background:#ecf0f1;padding:18px;border-radius:8px;margin-top:15px;display:none}
.total-price{font-size:30px;color:#e74c3c;font-weight:700;text-align:center;margin:10px 0}
.history-item{background:#fff;border:1px solid #e1e8ed;border-radius:6px;padding:10px 12px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
@media(max-width:700px){.box-item{flex-direction:column;align-items:stretch}}
</style>
</head>
<body>
<div class="container">
  <div class="header"><h1>木箱报价计算器</h1><p>独立单价 · 保存历史 · 导出报价单</p></div>

  <div class="section">
    <h3>待算箱型列表</h3>
    <div id="boxList"></div>
    <button class="btn btn-success btn-block" onclick="addBox()">＋ 添加箱型</button>

    <button class="btn btn-primary btn-block" onclick="calculate()">计算总价</button>

    <div id="resultArea" class="result-area">
      <div class="total-price" id="totalPrice">¥0.00</div>
      <div id="resultDetails"></div>
      <button class="btn btn-success" onclick="exportQuotation()">导出报价单</button>
    </div>

    <h3 style="margin-top:25px">历史报价记录</h3>
    <div id="historyList"></div>
  </div>
</div>

<script>
/************  数据池  ************/
let boxCounter = 0;
let currentCalc = {};// 本次结果
/************  初始  ************/
window.onload = ()=>{loadHistory(); addBox();};
/************  添加箱型 - 横排  ************/
function addBox(){
  boxCounter++;
  const id = `box-${boxCounter}`;
  const div = document.createElement('div');
  div.className = 'box-item'; div.id = id;
  div.innerHTML = `
    <div class="box-item-header">
      <span class="box-item-title">箱型 ${boxCounter}</span>
      <button class="btn btn-danger" onclick="delBox('${id}')">删除</button>
    </div>
    <div class="input-group"><label>长 (cm)</label><input type="number" min="0.1" step="0.1" data-key="l"></div>
    <div class="input-group"><label>宽 (cm)</label><input type="number" min="0.1" step="0.1" data-key="w"></div>
    <div class="input-group"><label>高 (cm)</label><input type="number" min="0.1" step="0.1" data-key="h"></div>
    <div class="input-group"><label>单价 (元/m²)</label><input type="number" min="0.01" step="0.01" data-key="price"></div>
    <div class="input-group"><label>数量</label><input type="number" min="1" step="1" data-key="q"></div>`;
  document.getElementById('boxList').appendChild(div);
}
/************  删除  ************/
function delBox(id){const card=document.getElementById(id);card.style.animation='fadeOut .3s';setTimeout(()=>card.remove(),300);}
/************  计算  ************/
function calculate(){
  const cards=document.querySelectorAll('.box-item');
  if(!cards.length){alert('请先添加箱型');return;}
  currentCalc={items:[],total:0,date:new Date().toLocaleString('zh-CN')};
  let html='';
  cards.forEach((c,i)=>{
    const l=parseFloat(c.querySelector('[data-key=l]').value)||0;
    const w=parseFloat(c.querySelector('[data-key=w]').value)||0;
    const h=parseFloat(c.querySelector('[data-key=h]').value)||0;
    const price=parseFloat(c.querySelector('[data-key=price]').value)||0;
    const q=parseInt(c.querySelector('[data-key=q]').value)||0;
    if(!(l&&w&&h&&price&&q)){alert(`第${i+1}项数据不完整`);return;}
    const area=2*(l*w+l*h+w*h)/10000;// m²
    const money=area*price*q;
    currentCalc.items.push({size:`${l}×${w}×${h}cm`,q,area:area.toFixed(4),price,money:money.toFixed(2)});
    currentCalc.total+=money;
    html+=`<div>箱型${i+1}  ${currentCalc.items[i].size} ×${q}  面积:${area.toFixed(4)}m²  单价:¥${price}  小计:¥${money.toFixed(2)}</div>`;
  });
  if(currentCalc.items.length===0)return;
  document.getElementById('resultDetails').innerHTML=html;
  document.getElementById('totalPrice').textContent=`¥${currentCalc.total.toFixed(2)}`;
  document.getElementById('resultArea').style.display='block';
  saveHistory(currentCalc);
}
/************  历史  ************/
function saveHistory(data){
  let h=JSON.parse(localStorage.getItem('boxHistory')||'[]');
  h.unshift(data); if(h.length>50)h=h.slice(0,50);
  localStorage.setItem('boxHistory',JSON.stringify(h));
  loadHistory();
}
function loadHistory(){
  const h=JSON.parse(localStorage.getItem('boxHistory')||'[]');
  const box=document.getElementById('historyList');
  if(!h.length){box.innerHTML='<div style="color:#999">暂无历史记录</div>';return;}
  box.innerHTML=h.map((it,idx)=>`
    <div class="history-item">
      <div><div>${it.date}</div><div>共${it.items.length}项  总计:<b>¥${it.total.toFixed(2)}</b></div></div>
      <div><button class="btn btn-primary" onclick="loadToCalc(${idx})">载入</button><button class="btn btn-danger" onclick="delHistory(${idx})">删除</button></div>
    </div>`).join('');
}
function loadToCalc(idx){
  const h=JSON.parse(localStorage.getItem('boxHistory')||'[]')[idx]; if(!h)return;
  document.getElementById('boxList').innerHTML=''; boxCounter=0;
  h.items.forEach(it=>{addBox(); const c=document.querySelectorAll('.box-item').length-1,row=document.querySelectorAll('.box-item')[c]; const [l,w,h]=it.size.replace('cm','').split('×'); row.querySelector('[data-key=l]').value=l; row.querySelector('[data-key=w]').value=w; row.querySelector('[data-key=h]').value=h; row.querySelector('[data-key=price]').value=it.price; row.querySelector('[data-key=q]').value=it.q;});
  currentCalc=h; document.getElementById('resultDetails').innerHTML=h.items.map((it,i)=>`<div>箱型${i+1}  ${it.size} ×${it.q}  面积:${it.area}m²  单价:¥${it.price}  小计:¥${it.money}</div>`).join(''); document.getElementById('totalPrice').textContent=`¥${h.total.toFixed(2)}`; document.getElementById('resultArea').style.display='block'; window.scrollTo({top:0,behavior:'smooth'});
}
function delHistory(idx){let h=JSON.parse(localStorage.getItem('boxHistory')||'[]'); h.splice(idx,1); localStorage.setItem('boxHistory',JSON.stringify(h)); loadHistory();}
/************  导出  ************/
function exportQuotation(){
  if(!currentCalc.items.length){alert('暂无可导出的数据');return;}
  const title=`报价单_${new Date().toISOString().slice(0,10)}`;
  let csv=`序号,尺寸(cm),数量,面积(m²),单价(元/m²),金额(元)\n`;
  currentCalc.items.forEach((it,i)=>{csv+=`${i+1},${it.size},${it.q},${it.area},${it.price},${it.money}\n`;});
  csv+=`,,,,,总计,${currentCalc.total.toFixed(2)}`;
  const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'}); const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download=title+'.csv'; link.click();
}
/************  动画  ************/
const style=document.createElement('style'); style.textContent=`@keyframes fadeOut{from{opacity:1}to{opacity:0}}`; document.head.appendChild(style);

/************  手机端优化：回车跳转 + 自动滚动防遮挡  ************/
// 回车切换到下一个输入框
document.addEventListener('keydown', (e) => {
  if (e.key !== 'Enter' || e.target.tagName !== 'INPUT') return;
  const inputs = Array.from(document.querySelectorAll('input[type="number"]'));
  const idx = inputs.indexOf(e.target);
  if (idx !== -1 && idx < inputs.length - 1) {
    inputs[idx + 1].focus();
    e.preventDefault();
  }
});
// 聚焦时自动往上滚一点，避免键盘遮挡
document.addEventListener('focusin', (e) => {
  if (e.target.tagName === 'INPUT' && e.target.type === 'number') {
    setTimeout(() => {
      // 先让浏览器把元素滚到视口顶部
      e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      // 再手动往上多滚 50 像素（可根据需要调）
      window.scrollBy({ top: -300, behavior: 'smooth' });
    }, 300); // 等键盘完全弹出
  }
});
</script>
</body>
</html>




